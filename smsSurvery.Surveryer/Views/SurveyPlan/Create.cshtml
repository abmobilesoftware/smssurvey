@model smsSurvey.dbInterface.SurveyPlan

@{
    ViewBag.Title = "Create";
}

<script type="text/template" id="question-template">
   <%
      var questionType = "";
      if (Type == "no type") {
         questionType = "Type" 
      } else if (Type == "YesNo") {
         questionType = "Yes/No";
      } else if (Type == "FreeText") {
         questionType = "Free text";
      } else if (Type == "Rating") {
         questionType = "Rating";
      } else if (Type == "SelectOneFromMany") {
         questionType = "Select one from many";
      } else if (Type == "SelectManyFromMany") {
         questionType = "Select many from many";
      }
   %>
      <div class="input-append">
         <input class="question-input" type="text" value="<%= Text %>" placeholder="Input question..." />
         <div class="btn-group">
            <button class="btn dropdown-toggle type-btn" data-toggle="dropdown">
               <span class="type-btn-text"><%= questionType %></span>
               <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">            
               <li><a href="#" value="YesNo" class="question-type">Yes/No</a></li>
               <li><a href="#" value="FreeText" class="question-type">Free text</a></li>
               <li><a href="#" value="Rating" class="question-type">Rating</a></li>
               <li><a href="#" value="SelectOneFromMany" class="question-type">Select one from many</a></li>
               <li><a href="#" value="SelectManyFromMany" class="question-type">Select many from many</a></li>               
            </ul>
         </div>
      </div>         
      <a href="#" class="btn btn-danger delete-btn">Delete</a>
    
   <% if (Type == "SelectOneFromMany") { %>
      <a href="#multiple-answer-modal<%= Id %>" role="button" class="open-modal-btn btn edit-answers-btn" data-toggle="modal"><img class="icon" src="/Content/images/edit_20.png" />Edit answers</a>   

      <div id="multiple-answer-modal<%= Id %>" class="modal hide">
         <div class="modal-header">
            <button type="button" class="close-modal-btn close close-answers-modal-btn" data-dismiss="modal" aria-hidden="true">x</button>
            <h3> Configure answers </h3>
         </div>
         <div class="modal-body">
            <table class="table table-striped table-bordered answers-table">
                <% if (Answers.length > 0) {
                  _.each(Answers, function(answer, index) { %>
                  <tr index="<%= index %>">
                     <td><%= index %></td>
                     <td><input class="answer-label-input" type="text" value="<%= answer.AnswerLabel %>" placeholder="Input answer..." /></td>
                     <td><button class="btn btn-danger delete-answer">Delete answer</button></td>
                  </tr>     
               <% });
                  } else { %>
                  <td>No answer</td>
               <% } %>
            </table>
            <a class="btn btn-primary add-answer-btn">Add answer</a>
         </div>
      </div>
   <% } else if (Type == "Rating") { %>
      <a href="#" role="button" class="open-modal-btn btn" data-toggle="modal">Edit rating</a>   
   <% } %>
   <a href="#edit-alerts-modal<%= Id %>" role="button" class="open-modal-btn btn edit-alerts-btn" data-toggle="modal"><img class="icon" src="/Content/images/bell-20.png" />Edit alerts</a>   
   
   <div id="edit-alerts-modal<%= Id %>" class="modal hide">
      <div class="modal-header">
         <button type="button" class="close-modal-btn close close-alerts-modal-btn" data-dismiss="modal" aria-hidden="true">x</button>
         <h3>Edit alerts</h3>
      </div>
      <div class="modal-body">
         <% if (QuestionAlertSet.length > 0) {
            _.each(QuestionAlertSet, function(alert, index) { %>
               <div class="alert-entry" index="<%= index %>">
                  <select class="alert-operator-select">
                     <% _.each(AlertOperators, function(alertOperator, index) { 
                           if (alertOperator == alert.Operator) { %>
                              <option value="<%= alertOperator %>" selected="selected"><%= alertOperator %></option>
                           <% } else { %>         
                              <option value="<%= alertOperator %>"><%= alertOperator %></option>
                        <% }
                     });%>
                  </select>
                  <input type="text" class="alert-value-input" value="<%= alert.TriggerAnswer %>" />
                  <button class="btn btn-danger delete-alert-btn"><img src="/Content/images/close_20.png" /></button><br/>
                  <span>Send mail to:</span>
                  <span><input type="text" class="alert-notification-mail-input" placeholder="Ex: abc@domain.net" value="<%= alert.AlertNotificationMail %>" /></span>                                
               </div>
            <% });
               } else { %>
               <div class="alert-entry">
                  No alerts added
               </div>
            <% } %>    
         <button class="btn btn-primary add-alert-btn">Add alert</button>         
         
         
      </div>
   </div>
</script>

<script id="preview-sms-template" type="text/template">
   <img src="/Content/images/iphone_frame.png" />
   <div class="preview-content">

   </div>
</script>

<script id="preview-website-template" type="text/template">
   <img src="/Content/images/iphone_frame.png" />
   <div class="preview-content">

   </div>
</script>

<script id="question-preview-website-template" type="text/template">
        <div class="website-question-preview">
            <h4 class="website-question-title-preview"> <%= Text %> </h4>
            <div class="website-answer-area-preview">
               <%
               if (Type == SurveyUtilities.Utilities.CONSTANTS_QUESTION.TYPE_YES_NO) { %>
                   <input type="radio" name="yes-no-answer" value="Yes" /> Yes <br/>
                   <input type="radio" name="yes-no-answer" value="No" /> No  
               <% 
               } else if (Type == SurveyUtilities.Utilities.CONSTANTS_QUESTION.TYPE_FREE_TEXT) {
               %>
                   <textarea class="website-answer website-comment"></textarea>
               <%
               } else if (Type == SurveyUtilities.Utilities.CONSTANTS_QUESTION.TYPE_RATING) {
               %>
                
               <%
               } else if (Type == SurveyUtilities.Utilities.CONSTANTS_QUESTION.TYPE_SELECT_ONE_FROM_MANY) { 
                  _.each(Answers, function(answer, index) {  %>
                     <input type="checkbox" name="multiple-answers" value="<%= answer.AnswerLabel %>" /> <%=answer.AnswerLabel %> <br/>
               <% });
               } %>           
            </div>
        </div>
</script>

<script type="text/template" id="question-preview-sms-template">
   <% 
   var questionText = Text;
   if (Type == SurveyUtilities.Utilities.CONSTANTS_QUESTION.TYPE_YES_NO) {
      questionText += " If your answer is Yes reply with 1, else reply with 2.";
   } else if (Type == SurveyUtilities.Utilities.CONSTANTS_QUESTION.TYPE_RATING) {
      questionText += " Reply with a rating from 1 (worse) to 5 (best).";
   } else if (Type == SurveyUtilities.Utilities.CONSTANTS_QUESTION.TYPE_SELECT_ONE_FROM_MANY) {
      questionText += " Reply with the corresponding number.";
      _.each(Answers, function(answer, index) {
         questionText += index + "-" + answer.AnswerLabel + ", ";
      });
   }
   %>
   <div class="customer">
      <p class="message"><%= questionText %></p>     
   </div>
   <div class="staff">
      Customer's answer
   </div>
</script>


<script type="text/template" id="star-template">
        <% if (Active) { %>
            <a href="#"><img class="starImg" src="/Content/images/star50.png" /></a>
            <% } else { %>
            <a href="#"><img class="starImg" src="/Content/images/star50_inactive.png" /></a>
            <% } %>
</script>

<script type="text/template" id="star-bar-template">
   <fieldset class='additionalInfo'>
      <legend class='stars-additional-info'>Why?</legend><textarea class='website-comment'></textarea>
   </fieldset>
   <input type='hidden' class='answer' value='noValue' />
</script>

<script type="text/template" id="survey-info-template">
   <div id="survey-info-title" class="section-title">
      <h4 class="section-title-text">
         <a class="edit-survey" href="#">
         <% if (DisplayInfoTable) { %>
            <img src="/Content/images/arrow_down_dblue_16.png" />           
         <% } else { %>
            <img src="/Content/images/arrow_up_dblue_16.png" />
         <% } %>
         </a>
         <span class="survey-info-title-text"><%= Description %></span> 
      </h4> 
      <a class="btn btn-success save-btn section-title-button" role="button" data-toggle="modal" href="#">Save</a>
   </div>
   <% if (DisplayInfoTable) { %> 
   <table class="table table-striped table-bordered survey-info-data">
      <tr>
         <td>Description</td>
         <td><input type="text" id="survey-description" value="<%= Description %>"/></td>
      </tr>
      <tr>
         <td>Thank you message & follow up</td>
         <td><input type="text" id="survey-thank-you-message" value="<%= ThankYouMessage %>"/></td>
      </tr>
      <tr>
         <td>ID</td>
         <td><%= Id %></td>
      </tr>
      <tr>
         <td>ShortID</td>
         <td>bogus short id</td>
      </tr>
      </table>
   <% } %>
</script>
<div id="survey">
   <div id="survey-notification hide">
      <p class="notification-text"></p>
   </div>
   <div id="survey-info">
      
   </div>
   <div id="survey-builder">
      <div class="survey-builder-title-wrapper section-title">
         <h4 class="survey-builder-title section-title-text">Questions</h4>
         <a class="btn btn-warning preview-btn section-title-button" role="button" data-toggle="modal" href="#preview-modal">Preview</a>
         <div class="clear"></div>
      </div>
      <div id="question-set">
         <ul id="question-set-content">
         </ul>
         <button class="btn btn-primary add-question-btn" type="button">Add question</button>
      </div>
      <div id="preview-modal" class="modal hide fade">
         <div class="modal-header">
            <button type="button" class="close-modal-btn close" data-dismiss="modal" aria-hidden="true">x</button>
            <div class="btn-group preview-tabs" data-toggle="buttons-radio">
               <button type="button" class="btn btn-primary sms-preview-btn active">SMS</button>
               <button type="button" class="btn btn-primary mobile-website-btn">Mobile website</button>
            </div>
         </div>
         <div id="preview-content-modal" class="modal-body">
         </div>
      </div>
   </div>
</div>

@section Scripts {
   @Scripts.Render("~/bundles/jqueryval")
   @Scripts.Render("~/bundles/myscripts")

}

@section css {
   @Styles.Render("~/bundles/SurveyPlan")
}